#!/usr/bin/env bash

if [ $(id -u) -ne 0 ]; then
    echo "Run as root" >&2
    exit 1
fi

if ! snapctl is-connected raw-usb; then
    echo "Failed to enable ${SNAP_NAME} service!" >&2
    echo ""
    echo "Consult the help command:" >&2
    echo "${SNAP_NAME}.help" >&2
    echo ""
    echo "Ensure ${SNAP_NAME} is booting successfully before daemonize it" >&2
    echo "by running the app manually (${SNAP_NAME}.exec)." >&2
    exit 1
fi

snapctl start --enable "${SNAP_NAME}.${SNAP_NAME}"

if [ $? -eq 0 ]; then
    echo "Service enabled! Follow logs with"
    echo "$ snap logs ${SNAP_NAME}"
    exit 0
fi

echo "Failed enabling service" >&2
exit 1
